<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>21ç‚¹æ¸¸æˆ Webç‰ˆï¼ˆåŒç©å®¶ï¼‰</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }

        /* é¡µé¢ä¸»ä½“æ ·å¼ */
        body {
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        /* æ¸¸æˆæ ‡é¢˜ */
        h1 {
            color: #f1c40f;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        /* æ¸¸æˆå®¹å™¨ */
        .game-container {
            background-color: #3498db20;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            width: 80%;
            max-width: 800px;
        }

        /* ç©å®¶/åº„å®¶åŒºåŸŸæ ·å¼ */
        .player-area {
            margin-bottom: 30px;
        }

        .player-area h2 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }

        /* æ‰‹ç‰Œå±•ç¤ºåŒº */
        .hand-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        /* å•å¼ ç‰Œæ ·å¼ */
        .card {
            background-color: white;
            color: black;
            width: 80px;
            height: 120px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* ç‚¹æ•°æç¤º */
        .total-points {
            font-size: 1.2rem;
            color: #ecf0f1;
            margin-top: 5px;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        button {
            padding: 12px 24px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #initBtn {
            background-color: #2ecc71;
            color: white;
        }

        /* åŒºåˆ†ä¸åŒç©å®¶çš„æ“ä½œæŒ‰é’® */
        .player1-btn {
            background-color: #3498db;
            color: white;
        }
        .player2-btn {
            background-color: #9b59b6;
            color: white;
        }
        #standBtn {
            background-color: #e74c3c;
            color: white;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ç»“æœæç¤º */
        .result {
            margin-top: 20px;
            font-size: 1.5rem;
            text-align: center;
            color: #f1c40f;
            min-height: 2rem;
            white-space: pre-line; /* æ–°å¢ï¼šæ”¯æŒæ¢è¡Œæ˜¾ç¤ºå¤šç©å®¶ç»“æœ */
        }
    </style>
</head>
<body>
    <h1>ğŸ² 21ç‚¹æ¸¸æˆ Webç‰ˆ</h1>
    <div class="game-container">
        <!-- åº„å®¶åŒºåŸŸ -->
        <div class="player-area">
            <h2>åº„å®¶</h2>
            <div id="dealerHand" class="hand-container"></div>
            <div id="dealerTotal" class="total-points">ç‚¹æ•°ï¼š0</div>
        </div>

        <!-- ç©å®¶1åŒºåŸŸ -->
        <div class="player-area">
            <h2>ç©å®¶1</h2>
            <div id="player1Hand" class="hand-container"></div>
            <div id="player1Total" class="total-points">ç‚¹æ•°ï¼š0</div>
        </div>

        <!-- ç©å®¶2åŒºåŸŸ -->
        <div class="player-area">
            <h2>ç©å®¶2</h2>
            <div id="player2Hand" class="hand-container"></div>
            <div id="player2Total" class="total-points">ç‚¹æ•°ï¼š0</div>
        </div>

        <!-- ç»“æœæç¤º -->
        <div id="gameResult" class="result"></div>

        <!-- æ“ä½œæŒ‰é’®ï¼šä¼˜åŒ–ä¸ºâ€œå½“å‰ç©å®¶åœç‰Œâ€ -->
        <div class="btn-container">
            <button id="initBtn">å¼€å§‹æ¸¸æˆ</button>
            <button id="player1HitBtn" class="player1-btn" disabled>ç©å®¶1æŠ½ç‰Œ</button>
            <button id="player2HitBtn" class="player2-btn" disabled>ç©å®¶2æŠ½ç‰Œ</button>
            <button id="standBtn" disabled>å½“å‰ç©å®¶åœç‰Œ</button>
        </div>
    </div>

    <!-- å¼•å…¥Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // 1. è·å–é¡µé¢å…ƒç´ 
        const initBtn = document.getElementById('initBtn');
        const player1HitBtn = document.getElementById('player1HitBtn');
        const player2HitBtn = document.getElementById('player2HitBtn');
        const standBtn = document.getElementById('standBtn');
        const player1Hand = document.getElementById('player1Hand');
        const player2Hand = document.getElementById('player2Hand');
        const dealerHand = document.getElementById('dealerHand');
        const player1Total = document.getElementById('player1Total');
        const player2Total = document.getElementById('player2Total');
        const dealerTotal = document.getElementById('dealerTotal');
        const gameResult = document.getElementById('gameResult');

        // å…¨å±€å˜é‡ï¼šè®°å½•å½“å‰å¯æ“ä½œçš„ç©å®¶ID
        let currentPlayerId = 0;

        // 2. åˆå§‹åŒ–æ¸¸æˆ
        initBtn.addEventListener('click', async () => {
            try {
                const response = await axios.post(
                    'http://localhost:5000/api/init_game',
                    { player_count: 2 },
                    { headers: { 'Content-Type': 'application/json' } }
                );
                const data = response.data;

                // æ›´æ–°æ‰‹ç‰Œå’Œç‚¹æ•°
                updateHand(player1Hand, data.players[0].hand);
                updateHand(player2Hand, data.players[1].hand);
                updateHand(dealerHand, data.dealer.hand);
                player1Total.textContent = `ç‚¹æ•°ï¼š${data.players[0].total}`;
                player2Total.textContent = `ç‚¹æ•°ï¼š${data.players[1].total}`;
                dealerTotal.textContent = `ç‚¹æ•°ï¼š${data.dealer.total}`;

                // æ›´æ–°å½“å‰ç©å®¶IDå’ŒæŒ‰é’®çŠ¶æ€
                currentPlayerId = data.current_player_id || 0;
                updateButtonStatus();
                gameResult.textContent = `æ¸¸æˆå¼€å§‹ï¼å½“å‰è½®åˆ°ã€ç©å®¶${currentPlayerId + 1}ã€‘æ“ä½œ`;

                // ç¦ç”¨å¼€å§‹æ¸¸æˆï¼Œå¯ç”¨åœç‰ŒæŒ‰é’®
                initBtn.disabled = true;
                standBtn.disabled = false;
            } catch (error) {
                gameResult.textContent = `åˆå§‹åŒ–å¤±è´¥ï¼š${error.response?.data?.error || error.message}`;
            }
        });

        // 3. ç©å®¶1æŠ½ç‰Œ
        player1HitBtn.addEventListener('click', async () => {
            if (currentPlayerId !== 0) {
                gameResult.textContent = "è¯·å…ˆå®Œæˆç©å®¶1çš„æ“ä½œåï¼Œå†æ“ä½œç©å®¶2ï¼";
                return;
            }

            try {
                const response = await axios.post(
                    'http://localhost:5000/api/player_hit',
                    { player_id: 0 },
                    { headers: { 'Content-Type': 'application/json' } }
                );
                const data = response.data;

                // æ›´æ–°ç©å®¶1çš„æ‰‹ç‰Œå’Œç‚¹æ•°
                updateHand(player1Hand, data.players[0].hand);
                player1Total.textContent = `ç‚¹æ•°ï¼š${data.players[0].total}`;

                // ä¼˜å…ˆæ˜¾ç¤ºåç«¯è¿”å›çš„ç»“æœï¼ˆä¿®å¤æç¤ºè¯­é”™è¯¯ï¼‰
                gameResult.textContent = data.result;

                // æ›´æ–°å½“å‰ç©å®¶ID
                currentPlayerId = data.current_player_id || currentPlayerId;
                updateButtonStatus();

                // è‹¥æ¸¸æˆç»“æŸï¼Œç›´æ¥æ˜¾ç¤ºæœ€ç»ˆç»“æœ
                if (data.game_over) {
                    updateHand(dealerHand, data.dealer.hand);
                    dealerTotal.textContent = `ç‚¹æ•°ï¼š${data.dealer.total}`;
                    resetGameButtons();
                }
            } catch (error) {
                gameResult.textContent = `ç©å®¶1æŠ½ç‰Œå¤±è´¥ï¼š${error.response?.data?.error || error.message}`;
            }
        });

        // 4. ç©å®¶2æŠ½ç‰Œï¼ˆæ ¸å¿ƒä¿®å¤ï¼šåŒæ­¥æœ€ç»ˆç»“æœï¼‰
        player2HitBtn.addEventListener('click', async () => {
            if (currentPlayerId !== 1) {
                gameResult.textContent = "è¯·å…ˆå®Œæˆç©å®¶1çš„æ“ä½œåï¼Œå†æ“ä½œç©å®¶2ï¼";
                return;
            }

            try {
                const response = await axios.post(
                    'http://localhost:5000/api/player_hit',
                    { player_id: 1 },
                    { headers: { 'Content-Type': 'application/json' } }
                );
                const data = response.data;

                // æ›´æ–°ç©å®¶2çš„æ‰‹ç‰Œå’Œç‚¹æ•°
                updateHand(player2Hand, data.players[1].hand);
                player2Total.textContent = `ç‚¹æ•°ï¼š${data.players[1].total}`;

                // æ ¸å¿ƒä¿®å¤1ï¼šç›´æ¥æ˜¾ç¤ºåç«¯è¿”å›çš„ç»“æœï¼ˆé¿å…å‰ç«¯è‡ªå®šä¹‰æç¤ºè¯­é”™è¯¯ï¼‰
                gameResult.textContent = data.result;

                // æ ¸å¿ƒä¿®å¤2ï¼šæ¸¸æˆç»“æŸæ—¶ç«‹å³æ›´æ–°åº„å®¶æ‰‹ç‰Œå’Œæœ€ç»ˆç»“æœ
                if (data.game_over) {
                    updateHand(dealerHand, data.dealer.hand);
                    dealerTotal.textContent = `ç‚¹æ•°ï¼š${data.dealer.total}`;
                    resetGameButtons();
                }

                // æ›´æ–°å½“å‰ç©å®¶ID
                currentPlayerId = data.current_player_id || currentPlayerId;
                updateButtonStatus();

            } catch (error) {
                gameResult.textContent = `ç©å®¶2æŠ½ç‰Œå¤±è´¥ï¼š${error.response?.data?.error || error.message}`;
            }
        });

        // 5. å½“å‰ç©å®¶åœç‰Œ
        standBtn.addEventListener('click', async () => {
            try {
                const response = await axios.post(
                    'http://localhost:5000/api/player_stand',
                    { player_id: currentPlayerId },
                    { headers: { 'Content-Type': 'application/json' } }
                );
                const data = response.data;

                // æ˜¾ç¤ºåç«¯è¿”å›çš„ç»“æœ
                gameResult.textContent = data.result;

                // æ¸¸æˆç»“æŸæ—¶æ›´æ–°åº„å®¶ç»“æœ
                if (data.game_over) {
                    updateHand(dealerHand, data.dealer.hand);
                    dealerTotal.textContent = `ç‚¹æ•°ï¼š${data.dealer.total}`;
                    resetGameButtons();
                }

                // æ›´æ–°å½“å‰ç©å®¶ID
                currentPlayerId = data.current_player_id || currentPlayerId;
                updateButtonStatus();

            } catch (error) {
                gameResult.textContent = `åœç‰Œå¤±è´¥ï¼š${error.response?.data?.error || error.message}`;
            }
        });

        // è¾…åŠ©å‡½æ•°1ï¼šæ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtonStatus() {
            // å…ˆç¦ç”¨æ‰€æœ‰æŠ½ç‰ŒæŒ‰é’®
            player1HitBtn.disabled = true;
            player2HitBtn.disabled = true;

            // åªå¯ç”¨å½“å‰è½®æ¬¡ç©å®¶çš„æŠ½ç‰ŒæŒ‰é’®
            if (currentPlayerId === 0 && !initBtn.disabled) {
                player1HitBtn.disabled = false;
            } else if (currentPlayerId === 0) {
                player1HitBtn.disabled = false;
            } else if (currentPlayerId === 1) {
                player2HitBtn.disabled = false;
            } else {
                standBtn.disabled = true;
            }
        }

        // è¾…åŠ©å‡½æ•°2ï¼šæ›´æ–°æ‰‹ç‰Œå±•ç¤º
        function updateHand(container, cards) {
            container.innerHTML = '';
            cards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.innerHTML = `
                    <span>${card.suit}</span>
                    <span>${card.rank}</span>
                `;
                container.appendChild(cardElement);
            });
        }

        // è¾…åŠ©å‡½æ•°3ï¼šæ¸¸æˆç»“æŸåé‡ç½®æŒ‰é’®çŠ¶æ€
        function resetGameButtons() {
            player1HitBtn.disabled = true;
            player2HitBtn.disabled = true;
            standBtn.disabled = true;
            initBtn.disabled = false;
        }
    </script>
</body>
</html>